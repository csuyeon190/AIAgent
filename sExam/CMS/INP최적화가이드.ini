INP ìµœì í™” ì™„ë²½ ê°€ì´ë“œ ğŸš€
INPë¥¼ ê°œì„ í•˜ë ¤ë©´ ì‚¬ìš©ì ìƒí˜¸ì‘ìš©(í´ë¦­, íƒ­, í‚¤ì…ë ¥) ì²˜ë¦¬ ì†ë„ë¥¼ ë¹ ë¥´ê²Œ í•´ì•¼ í•´ìš”. ì‹¤ì „ ì½”ë“œë¡œ ì„¤ëª…ë“œë¦´ê²Œìš”!
1. Long Tasks ë¶„í•  (ê°€ì¥ ì¤‘ìš”!) âš¡
âŒ ë¬¸ì œ: 50ms ì´ìƒ ë¸”ë¡œí‚¹
javascript// ë‚˜ìœ ì˜ˆ: GNB ì´ˆê¸°í™” ì‹œ ëª¨ë“  ì‘ì—…ì„ ë™ê¸°ë¡œ ì²˜ë¦¬
function M00_A(el) {
    this.$el = el;
    
    // ğŸ˜± ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ (200ms+)
    this.getData(url);              // 50ms
    this.drawGnb();                 // 80ms
    this.addEventListener();        // 40ms
    this.initSubmenuSize();         // 30ms
    // ì´ 200ms ë¸”ë¡œí‚¹!
    // ì´ ì‹œê°„ ë™ì•ˆ ì‚¬ìš©ì í´ë¦­ ë¬´ë°˜ì‘
}

// ì‚¬ìš©ìê°€ ë²„íŠ¼ í´ë¦­ â†’ 200ms ë’¤ì—ì•¼ ë°˜ì‘ â†’ INP ë‚˜ì¨!
âœ… í•´ê²°: ì‘ì—… ë¶„í• 
javascript// ì¢‹ì€ ì˜ˆ: requestIdleCallback í™œìš©
class GNBController {
    async init() {
        // 1. í•„ìˆ˜ ì‘ì—…ë§Œ ì¦‰ì‹œ ì‹¤í–‰ (ë¹ ë¥¸ ì´ˆê¸° ë Œë”ë§)
        await this.loadCriticalData();  // 30ms
        this.renderBasicUI();           // 20ms
        
        // 2. ë‚˜ë¨¸ì§€ëŠ” ìœ íœ´ ì‹œê°„ì— ì‹¤í–‰
        this.scheduleNonCriticalTasks();
    }

    scheduleNonCriticalTasks() {
        if ('requestIdleCallback' in window) {
            requestIdleCallback(() => {
                this.drawGnb();
                this.addEventListener();
            }, { timeout: 2000 });
        } else {
            // í´ë°±: setTimeout
            setTimeout(() => {
                this.drawGnb();
                this.addEventListener();
            }, 1);
        }
    }
}
âœ… ë” ë‚˜ì€ ë°©ë²•: Scheduler API (Chrome 94+)
javascriptclass GNBController {
    async init() {
        // Critical: ì¦‰ì‹œ ì‹¤í–‰
        await this.loadCriticalData();
        
        // Background: ë‚®ì€ ìš°ì„ ìˆœìœ„ë¡œ ì‹¤í–‰
        if ('scheduler' in window) {
            scheduler.postTask(() => {
                this.drawGnb();
            }, { priority: 'background' });
            
            scheduler.postTask(() => {
                this.addEventListener();
            }, { priority: 'background' });
        } else {
            // í´ë°±
            this.scheduleNonCriticalTasks();
        }
    }
}
2. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìµœì í™” ğŸ¯
âŒ ë¬¸ì œ: ë¬´ê±°ìš´ ë™ê¸° ì²˜ë¦¬
javascript// ë‚˜ìœ ì˜ˆ: í´ë¦­ ì‹œ ëª¨ë“  ì‘ì—…ì„ ë™ê¸°ë¡œ
$('.btn-search').on('click', function(e) {
    // ğŸ˜± 100ms+ ë¸”ë¡œí‚¹
    _this.closeMobileGsnb();        // 30ms
    _this.rnbMenuClose();           // 25ms
    _this.searchBoxClose();         // 20ms
    _this.setHeightRightContainer(); // 25ms
    $('body').addClass('hid_s');     // 5ms
    $('.search_box').show();         // 15ms
    // ì´ 120ms â†’ INP ë‚˜ì¨
});
âœ… í•´ê²°: ì¦‰ì‹œ í”¼ë“œë°± + ë¹„ë™ê¸° ì²˜ë¦¬
javascript// ì¢‹ì€ ì˜ˆ: ì‹œê°ì  í”¼ë“œë°± ë¨¼ì €, ë¬´ê±°ìš´ ì‘ì—…ì€ ë‚˜ì¤‘ì—
$('.btn-search').on('click', async function(e) {
    e.preventDefault();
    
    // 1. ì¦‰ì‹œ ì‹œê°ì  í”¼ë“œë°± (5ms ì´ë‚´)
    $(this).addClass('loading');
    $('.search_box').css('display', 'block');
    
    // 2. ë¬´ê±°ìš´ ì‘ì—…ì€ ë‹¤ìŒ í”„ë ˆì„ìœ¼ë¡œ
    await yieldToMain();
    _this.closeMobileGsnb();
    
    await yieldToMain();
    _this.rnbMenuClose();
    
    await yieldToMain();
    _this.setHeightRightContainer();
    
    $(this).removeClass('loading');
});

// í—¬í¼ í•¨ìˆ˜: ë©”ì¸ ìŠ¤ë ˆë“œì— ì–‘ë³´
function yieldToMain() {
    return new Promise(resolve => {
        setTimeout(resolve, 0);
    });
}
âœ… ë” ì¢‹ì€ ë°©ë²•: ì‘ì—… ìš°ì„ ìˆœìœ„ ê´€ë¦¬
javascriptclass TaskScheduler {
    constructor() {
        this.tasks = [];
        this.isRunning = false;
    }

    // ë†’ì€ ìš°ì„ ìˆœìœ„ ì‘ì—… (ì¦‰ì‹œ ì‹¤í–‰)
    runImmediately(task) {
        return task();
    }

    // ë‚®ì€ ìš°ì„ ìˆœìœ„ ì‘ì—… (íì— ì¶”ê°€)
    schedule(task, priority = 'normal') {
        this.tasks.push({ task, priority });
        this.processTasks();
    }

    async processTasks() {
        if (this.isRunning) return;
        this.isRunning = true;

        while (this.tasks.length > 0) {
            const { task } = this.tasks.shift();
            
            // ê° ì‘ì—… ì‚¬ì´ì— ì–‘ë³´
            await new Promise(resolve => setTimeout(resolve, 0));
            await task();
        }

        this.isRunning = false;
    }
}

// ì‚¬ìš© ì˜ˆì‹œ
const scheduler = new TaskScheduler();

$('.btn-search').on('click', function(e) {
    e.preventDefault();
    
    // ì¦‰ì‹œ ì‹¤í–‰: ì‹œê°ì  í”¼ë“œë°±
    scheduler.runImmediately(() => {
        $(this).addClass('loading');
        $('.search_box').show();
    });
    
    // ìŠ¤ì¼€ì¤„ë§: ë¬´ê±°ìš´ ì‘ì—…
    scheduler.schedule(() => _this.closeMobileGsnb());
    scheduler.schedule(() => _this.rnbMenuClose());
    scheduler.schedule(() => _this.setHeightRightContainer());
});
3. DOM ì¡°ì‘ ìµœì í™” ğŸ“¦
âŒ ë¬¸ì œ: Layout Thrashing
javascript// ë‚˜ìœ ì˜ˆ: ì½ê¸°-ì“°ê¸°-ì½ê¸°-ì“°ê¸° ë°˜ë³µ (Layout Thrashing)
function updateMenu() {
    // ğŸ˜± Forced Reflow ë°œìƒ (ê° 10ms Ã— 10 = 100ms)
    $('.menu-item').each(function() {
        const height = $(this).height();      // ì½ê¸° â†’ Reflow
        $(this).css('padding', height / 2);   // ì“°ê¸° â†’ Reflow
    });
}
âœ… í•´ê²°: ì½ê¸°/ì“°ê¸° ë¶„ë¦¬
javascript// ì¢‹ì€ ì˜ˆ: Batch ì²˜ë¦¬
function updateMenu() {
    const $items = $('.menu-item');
    
    // 1. ëª¨ë“  ì½ê¸° ì‘ì—… ë¨¼ì €
    const heights = $items.map(function() {
        return $(this).height();
    }).get();
    
    // 2. ëª¨ë“  ì“°ê¸° ì‘ì—…ì€ ë‚˜ì¤‘ì—
    $items.each(function(index) {
        $(this).css('padding', heights[index] / 2);
    });
    // ì´ Reflow: 2íšŒ (ì½ê¸° 1íšŒ, ì“°ê¸° 1íšŒ)
}
âœ… ë” ì¢‹ì€ ë°©ë²•: requestAnimationFrame
javascript// ìµœì í™”: RAFë¡œ í˜ì¸íŠ¸ íƒ€ì´ë°ì— ë§ì¶¤
function updateMenu() {
    requestAnimationFrame(() => {
        const $items = $('.menu-item');
        
        // ì½ê¸°
        const heights = $items.map(function() {
            return $(this).height();
        }).get();
        
        // ì“°ê¸°ëŠ” ë‹¤ìŒ í”„ë ˆì„ì—
        requestAnimationFrame(() => {
            $items.each(function(index) {
                $(this).css('padding', heights[index] / 2);
            });
        });
    });
}
4. ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš© ğŸª
âŒ ë¬¸ì œ: ê°œë³„ ë¦¬ìŠ¤ë„ˆ ê³¼ë‹¤
javascript// ë‚˜ìœ ì˜ˆ: ë©”ë‰´ ì•„ì´í…œë§ˆë‹¤ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
$('.menu-item').each(function() {
    $(this).on('click', function() {
        // 100ê°œ ë©”ë‰´ = 100ê°œ ë¦¬ìŠ¤ë„ˆ
        handleMenuClick(this);
    });
});
// ë©”ëª¨ë¦¬ ë‚­ë¹„ + ì´ˆê¸°í™” ì‹œê°„ ì¦ê°€
âœ… í•´ê²°: ì´ë²¤íŠ¸ ìœ„ì„
javascript// ì¢‹ì€ ì˜ˆ: ë¶€ëª¨ì— 1ê°œë§Œ ë“±ë¡
$('.menu-container').on('click', '.menu-item', function(e) {
    // 1ê°œ ë¦¬ìŠ¤ë„ˆë¡œ ëª¨ë“  ì•„ì´í…œ ì²˜ë¦¬
    handleMenuClick(this);
});
// ë©”ëª¨ë¦¬ íš¨ìœ¨ + ë¹ ë¥¸ ì´ˆê¸°í™”
5. JavaScript ì‹¤í–‰ ì‹œê°„ ì¤„ì´ê¸° â±ï¸
âŒ ë¬¸ì œ: ë³µì¡í•œ ê³„ì‚°
javascript// ë‚˜ìœ ì˜ˆ: ë§¤ë²ˆ ê³„ì‚°
$('.gnb .menu > li').on('mouseenter', function() {
    // ğŸ˜± ë§¤ë²ˆ ë³µì¡í•œ ê³„ì‚° (15ms)
    const panelWidth = calculatePanelWidth();
    const gnbWidth = calculateGnbWidth();
    const offset = (panelWidth - gnbWidth) / 2;
    
    $(this).find('.childpanel').css('margin-left', offset);
});
âœ… í•´ê²°: ê³„ì‚° ê²°ê³¼ ìºì‹±
javascript// ì¢‹ì€ ì˜ˆ: í•œ ë²ˆë§Œ ê³„ì‚°
class GNBController {
    constructor() {
        this.cache = {};
        this.updateCache();
    }

    updateCache() {
        this.cache.panelWidth = this.calculatePanelWidth();
        this.cache.gnbWidth = this.calculateGnbWidth();
        this.cache.offset = (this.cache.panelWidth - this.cache.gnbWidth) / 2;
    }

    bindEvents() {
        $('.gnb .menu > li').on('mouseenter', () => {
            // âœ… ìºì‹œëœ ê°’ ì‚¬ìš© (1ms ë¯¸ë§Œ)
            $(this).find('.childpanel').css('margin-left', this.cache.offset);
        });

        // ë¦¬ì‚¬ì´ì¦ˆ ì‹œì—ë§Œ ì¬ê³„ì‚°
        $(window).on('resize', this.debounce(() => {
            this.updateCache();
        }, 200));
    }
}
6. Third-Party ìŠ¤í¬ë¦½íŠ¸ ì§€ì—° ë¡œë”© ğŸ“¦
âŒ ë¬¸ì œ: ë™ê¸° ë¡œë”©ìœ¼ë¡œ ë¸”ë¡œí‚¹
javascript// ë‚˜ìœ ì˜ˆ: ì´ˆê¸° ë¡œë”© ì‹œ ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
// Google Analytics
<script src="analytics.js"></script>  // 50ms ë¸”ë¡œí‚¹
// Facebook Pixel
<script src="fbevents.js"></script>   // 40ms ë¸”ë¡œí‚¹
// VWO
<script src="vwo.js"></script>        // 60ms ë¸”ë¡œí‚¹
// ì´ 150ms ë¸”ë¡œí‚¹
âœ… í•´ê²°: ì§€ì—° ë¡œë”© + ìš°ì„ ìˆœìœ„
javascript// ì¢‹ì€ ì˜ˆ: ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í›„ ë¡œë”©
class ScriptLoader {
    constructor() {
        this.loaded = new Set();
        this.loading = new Map();
    }

    async loadScript(url, priority = 'low') {
        if (this.loaded.has(url)) return;
        if (this.loading.has(url)) return this.loading.get(url);

        const promise = new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = url;
            script.async = true;
            script.onload = () => {
                this.loaded.add(url);
                resolve();
            };
            script.onerror = reject;

            // ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ë¡œë”© ì‹œì  ê²°ì •
            if (priority === 'high') {
                document.head.appendChild(script);
            } else {
                // ë‚®ì€ ìš°ì„ ìˆœìœ„ëŠ” ìœ íœ´ ì‹œê°„ì—
                requestIdleCallback(() => {
                    document.head.appendChild(script);
                }, { timeout: 2000 });
            }
        });

        this.loading.set(url, promise);
        return promise;
    }
}

// ì‚¬ìš© ì˜ˆì‹œ
const loader = new ScriptLoader();

// í˜ì´ì§€ ë¡œë“œ í›„ ì§€ì—° ë¡œë”©
window.addEventListener('load', () => {
    // ìœ íœ´ ì‹œê°„ì— ë¡œë”©
    requestIdleCallback(() => {
        loader.loadScript('https://www.google-analytics.com/analytics.js', 'low');
        loader.loadScript('https://connect.facebook.net/en_US/fbevents.js', 'low');
        loader.loadScript('https://dev.visualwebsiteoptimizer.com/j.php', 'low');
    });
});

// ë˜ëŠ” ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í›„ ë¡œë”©
let hasInteracted = false;
document.addEventListener('click', () => {
    if (!hasInteracted) {
        hasInteracted = true;
        loader.loadScript('analytics.js', 'high');
    }
}, { once: true });
7. ì‹¤ì „: GNB ì½”ë“œ INP ìµœì í™” ğŸ¯
javascriptclass GNBController {
    constructor(element) {
        this.$el = $(element);
        this.cache = {};
        this.scheduler = new TaskScheduler();
        
        // ì¦‰ì‹œ ì‹¤í–‰
        this.initCritical();
        
        // ì§€ì—° ì‹¤í–‰
        this.initNonCritical();
    }

    // í•„ìˆ˜ ì´ˆê¸°í™”ë§Œ (30ms ì´ë‚´)
    initCritical() {
        this.lang = $('html').attr('lang') || 'en';
        this.state = {
            isMobile: window.innerWidth <= 1024,
            isMobileDevice: /Mobile/.test(navigator.userAgent)
        };
    }

    // ë‚˜ë¨¸ì§€ëŠ” ìœ íœ´ ì‹œê°„ì—
    initNonCritical() {
        requestIdleCallback(() => {
            this.loadData();
            this.bindEvents();
            this.initializeUI();
        }, { timeout: 2000 });
    }

    // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìµœì í™”
    bindSearchButton() {
        $('.btn-search').on('click', async (e) => {
            e.preventDefault();
            
            // 1. ì¦‰ì‹œ í”¼ë“œë°± (5ms)
            $(e.currentTarget).addClass('active');
            $('.search_box').addClass('visible');
            
            // 2. ë¬´ê±°ìš´ ì‘ì—…ì€ ë¶„í• 
            await yieldToMain();
            this.closeMobileGsnb();
            
            await yieldToMain();
            this.rnbMenuClose();
            
            await yieldToMain();
            this.setHeight();
        });
    }

    // DOM ì¡°ì‘ ìµœì í™”
    updateGnbPosition() {
        requestAnimationFrame(() => {
            // ì½ê¸°
            const scroll = window.scrollY;
            const headerHeight = this.$el.height();
            
            // ì“°ê¸°ëŠ” ë‹¤ìŒ í”„ë ˆì„
            requestAnimationFrame(() => {
                this.$el.css('top', `${scroll > 60 ? -headerHeight : 0}px`);
            });
        });
    }

    // ê³„ì‚° ê²°ê³¼ ìºì‹±
    updateCache() {
        this.cache = {
            panelWidth: this.$el.width(),
            gnbHeight: this.$el.find('.gnb').height(),
            windowHeight: window.innerHeight,
            timestamp: Date.now()
        };
    }

    // Debounce ë¦¬ì‚¬ì´ì¦ˆ
    handleResize = this.debounce(() => {
        this.updateCache();
        this.updateGnbPosition();
    }, 200);

    debounce(fn, delay) {
        let timeout;
        return (...args) => {
            clearTimeout(timeout);
            timeout = setTimeout(() => fn.apply(this, args), delay);
        };
    }
}

// í—¬í¼ í•¨ìˆ˜
function yieldToMain() {
    return new Promise(resolve => setTimeout(resolve, 0));
}

class TaskScheduler {
    constructor() {
        this.tasks = [];
    }

    async schedule(task) {
        this.tasks.push(task);
        await this.run();
    }

    async run() {
        while (this.tasks.length) {
            const task = this.tasks.shift();
            await task();
            await yieldToMain();
        }
    }
}
8. ì¸¡ì • ë° ëª¨ë‹ˆí„°ë§ ğŸ“Š
javascript// Web Vitals ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
import {onINP, onFCP, onLCP} from 'web-vitals';

// INP ì¸¡ì •
onINP(({name, value, rating, attribution}) => {
    console.log('INP:', {
        value: `${value}ms`,
        rating, // 'good', 'needs-improvement', 'poor'
        interaction: attribution.interactionType,
        element: attribution.interactionTarget
    });

    // Analytics ì „ì†¡
    gtag('event', 'web-vitals', {
        event_category: 'Web Vitals',
        event_label: name,
        value: Math.round(value),
        metric_rating: rating
    });
});

// ê°œë°œ ì¤‘ ë””ë²„ê¹…
if (process.env.NODE_ENV === 'development') {
    onINP(({value, attribution}) => {
        console.warn(`âš ï¸ INP ${value}ms`, {
            element: attribution.interactionTarget,
            type: attribution.interactionType,
            inputDelay: attribution.inputDelay,
            processingDuration: attribution.processingDuration,
            presentationDelay: attribution.presentationDelay
        });
    });
}
9. INP ëª©í‘œ ë° ê¸°ì¤€ ğŸ¯
javascript// INP ì ìˆ˜ ê¸°ì¤€
INP < 200ms   â†’ Good (ë…¹ìƒ‰) âœ…
INP 200-500ms â†’ Needs Improvement (ì£¼í™©) âš ï¸
INP > 500ms   â†’ Poor (ë¹¨ê°•) âŒ

// ëª¨ë°”ì¼ì—ì„œ íŠ¹íˆ ì¤‘ìš”!
ë°ìŠ¤í¬í†±: 200ms ì´í•˜
ëª¨ë°”ì¼: 300ms ì´í•˜ (ë” ê´€ëŒ€í•œ ê¸°ì¤€)
10. ì²´í¬ë¦¬ìŠ¤íŠ¸ âœ…
markdown### INP ìµœì í™” ì²´í¬ë¦¬ìŠ¤íŠ¸

#### í•„ìˆ˜ (High Priority)
- [ ] Long Tasks 50ms ì´í•˜ë¡œ ë¶„í• 
- [ ] í´ë¦­ í•¸ë“¤ëŸ¬ ì¦‰ì‹œ í”¼ë“œë°± (<100ms)
- [ ] DOM ì¡°ì‘ Batching (ì½ê¸°/ì“°ê¸° ë¶„ë¦¬)
- [ ] ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš©
- [ ] Debounce/Throttle ì ìš©

#### ê¶Œì¥ (Medium Priority)
- [ ] requestIdleCallback í™œìš©
- [ ] ê³„ì‚° ê²°ê³¼ ìºì‹±
- [ ] Third-party ìŠ¤í¬ë¦½íŠ¸ ì§€ì—° ë¡œë”©
- [ ] Web Vitals ëª¨ë‹ˆí„°ë§ ì„¤ì •

#### ì„ íƒ (Low Priority)
- [ ] Scheduler API ì‚¬ìš© (Chrome 94+)
- [ ] Web Workers í™œìš© (ë¬´ê±°ìš´ ê³„ì‚°)
- [ ] Virtual Scrolling (ê¸´ ë¦¬ìŠ¤íŠ¸)
